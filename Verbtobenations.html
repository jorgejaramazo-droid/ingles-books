<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Verb To Be & Nationalities - Game Boy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #222 0, #050505 60%);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: #eee;
      overflow: hidden;
    }

    #game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      transform: scale(1);
    }

    #gameboy-frame {
      padding: 16px 16px 20px;
      border-radius: 26px;
      background: linear-gradient(145deg, #333, #111);
      box-shadow:
        0 20px 40px rgba(0,0,0,0.7),
        inset 0 0 10px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      border: 2px solid #555;
    }

    #title-strip {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #e5f5d0;
      font-size: 11px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
    }

    #title-main {
      font-weight: 700;
    }

    #title-sub {
      font-size: 9px;
      opacity: 0.8;
    }

    #status-bar {
      width: 100%;
      font-size: 9px;
      text-align: right;
      color: #9ac7a0;
      opacity: 0.9;
    }

    canvas {
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      border-radius: 8px;
      border: 4px solid #3f5b41;
      background: #99c98c; /* verde tipo Game Boy */
    }

    #controls-label {
      font-size: 10px;
      text-align: center;
      color: #bbb;
    }

    /* Controles t√°ctiles */
    #touch-controls {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      user-select: none;
    }

    .touch-row {
      display: flex;
      gap: 6px;
      justify-content: center;
    }

    .btn-control {
      width: 54px;
      height: 34px;
      border-radius: 16px;
      border: 2px solid #444;
      background: radial-gradient(circle at top, #666 0, #222 65%);
      color: #f5f5f5;
      font-size: 11px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow:
        0 4px 0 #000,
        0 6px 12px rgba(0,0,0,0.7);
      cursor: pointer;
      transition: transform 0.05s ease, box-shadow 0.05s ease, background 0.05s ease;
    }

    .btn-control:active {
      transform: translateY(3px);
      box-shadow:
        0 1px 0 #000,
        0 4px 8px rgba(0,0,0,0.6);
      background: radial-gradient(circle at top, #777 0, #333 65%);
    }

    .btn-small {
      width: 60px;
      height: 26px;
      border-radius: 20px;
      font-size: 9px;
    }

    #meta-info {
      margin-top: 3px;
      font-size: 9px;
      color: #777;
      text-align: center;
    }

    @media (max-width: 480px) {
      #game-container {
        transform: scale(0.9);
      }
    }

    @media (max-width: 380px) {
      #game-container {
        transform: scale(0.8);
      }
    }
  </style>
</head>
<body>
<div id="game-container">
  <div id="gameboy-frame">
    <div id="title-strip">
      <span id="title-main">To Be & Nationalities</span>
      <span id="title-sub">Hispanohablantes A1</span>
    </div>
    <div id="status-bar">
      üåç Mundo: NationQuest
    </div>

    <canvas id="game" width="320" height="240"></canvas>

    <div id="controls-label">
      PC: ‚ñ≤‚ñº + ENTER ¬∑ ESC &nbsp;|&nbsp; M√≥vil: botones t√°ctiles
    </div>

    <div id="touch-controls">
      <div class="touch-row">
        <div class="btn-control" data-action="up">‚ñ≤</div>
      </div>
      <div class="touch-row">
        <div class="btn-control" data-action="down">‚ñº</div>
        <div class="btn-control" data-action="ok">OK</div>
        <div class="btn-control btn-small" data-action="skip">SKIP</div>
      </div>
    </div>
  </div>

  <div id="meta-info">
    Aprende Ingl√©s Ya ¬∑ NationQuest ¬∑ Verb To Be + Nationalities
  </div>
</div>

<script>
/* =====================================================
   VERB TO BE + NATIONALITIES ‚Äî GAME BOY
   Para hispanohablantes ¬∑ Nivel A1
   Con teclado + touch + sonidos arcade
   ===================================================== */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Paleta verde tipo Game Boy
const COLORS = {
  bg: "#99c98c",
  dark: "#436646",
  darker: "#2b4530",
  light: "#cfe9c0",
  text: "#102010",
  accent: "#213921"
};

// Estados del juego
const SCREENS = {
  TITLE: "title",
  STORY: "story",
  EXPLAIN_AFFIRM: "explain_affirm",
  EXPLAIN_NEG: "explain_neg",
  EXPLAIN_INTER: "explain_inter",
  QUIZ: "quiz",
  SUMMARY: "summary"
};

let state = {
  screen: SCREENS.TITLE,
  selectionIndex: 0,
  storyPage: 0,
  explainPage: 0,
  quizIndex: 0,
  score: 0,
  totalQuestions: 0
};

// ==== AUDIO ARCADE SIMPLE ====
let audioCtx = null;

function initAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playBeep(type = "move") {
  if (!audioCtx) return;

  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  let freq = 440;
  let duration = 0.09;

  if (type === "move") {
    freq = 520;
    duration = 0.06;
  } else if (type === "ok") {
    freq = 740;
    duration = 0.11;
  } else if (type === "good") {
    freq = 880;
    duration = 0.15;
  } else if (type === "bad") {
    freq = 220;
    duration = 0.18;
  }

  osc.type = "square";
  osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
  gain.gain.setValueAtTime(0.16, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

// ==== HISTORIA (LIBRO) ====
const storyPages = [
  [
    "NATIONQUEST, LOBBY GLOBAL.",
    "",
    "Eres un estudiante hispano",
    "que quiere viajar por el",
    "mundo del ingles.",
    "",
    "Wizard Passport te explica:",
    "si no usas bien el",
    "VERB TO BE + nacionalidad,",
    "las fronteras del idioma",
    "se quedan cerradas.",
    "",
    "Tu mision:",
    "Presentarte y decir de",
    "donde eres, como un pro.",
    "",
    "ENTER / OK para continuar."
  ],
  [
    "Wizard Passport:",
    "",
    "\"En ingles, casi siempre",
    "presentas TU NOMBRE, TU",
    "NACIONALIDAD y TU CIUDAD\".",
    "",
    "\"Ejemplo largo:\"",
    "I'm Mexican. I'm from",
    "Guadalajara, but now I'm",
    "in Medan, Indonesia.\"",
    "",
    "\"Vamos a practicar con",
    "afirmativo, negativo y",
    "preguntas sobre paises.\"",
    "",
    "ENTER / OK = Empezar libro."
  ]
];

// ==== EXPLICACIONES (AFIRM, NEG, INTERROG.) ====
const explainAffirm = [
  [
    "1/3 ¬∑ AFIRMATIVO + PAIS",
    "",
    "Estructura basica:",
    "SUJETO + TO BE + NATIONALITY",
    "",
    "I am Mexican.",
    "You are Indonesian.",
    "He is American.",
    "She is Brazilian.",
    "We are Colombian.",
    "They are Japanese.",
    "",
    "Tambien puedes decir:",
    "I am from Mexico.",
    "She is from Brazil."
  ],
  [
    "2/3 ¬∑ CONTRACCIONES",
    "",
    "I'm Mexican.",
    "You're Indonesian.",
    "He's American.",
    "She's Brazilian.",
    "We're Peruvian.",
    "They're Spanish.",
    "",
    "Frase mas larga:",
    "I'm Mexican and I'm from",
    "Guadalajara, but now I'm",
    "in Medan, Indonesia."
  ],
  [
    "3/3 ¬∑ MAS EJEMPLOS",
    "",
    "She's Indonesian and she's",
    "from Medan, but now she's",
    "a student in Singapore.",
    "",
    "They're Japanese and",
    "they're from Tokyo,",
    "but now they're online",
    "in my English class.",
    "",
    "ENTER/OK = Negativo ¬∑ ESC/SKIP = Saltar"
  ]
];

const explainNeg = [
  [
    "1/2 ¬∑ NEGATIVO + PAIS",
    "",
    "SUJETO + TO BE + NOT + NATIONALITY",
    "",
    "I'm not American,",
    "I'm Mexican.",
    "",
    "She's not French,",
    "she's Italian.",
    "",
    "They're not from Spain,",
    "they're from Argentina."
  ],
  [
    "2/2 ¬∑ CONTRACCIONES NEG.",
    "",
    "I'm not Indonesian.",
    "You aren't Japanese.",
    "He isn't Brazilian.",
    "We aren't from Europe.",
    "",
    "Ejemplo largo:",
    "I'm not from Jakarta,",
    "I'm from Guadalajara,",
    "but now I'm in Indonesia.",
    "",
    "ENTER/OK = Preguntas ¬∑ ESC/SKIP = Saltar"
  ]
];

const explainInter = [
  [
    "1/2 ¬∑ PREGUNTAS CORTAS",
    "",
    "TO BE + SUJETO + NATIONALITY?",
    "",
    "Are you Mexican?",
    "Are you from Mexico City?",
    "Is she Indonesian?",
    "Is he from Medan?",
    "Are they Brazilian?",
    "",
    "Respuestas cortas:",
    "Yes, I am. / No, I'm not."
  ],
  [
    "2/2 ¬∑ PREGUNTAS LARGAS",
    "",
    "Are you Mexican or",
    "are you Colombian?",
    "",
    "Are they from Spain or",
    "are they from Chile?",
    "",
    "Is she Indonesian or",
    "is she Malaysian?",
    "",
    "ENTER/OK = Empezar quiz"
  ]
];

// ==== PREGUNTAS (EJERCICIOS LARGOS) ====
const quizQuestions = [
  {
    type: "affirm",
    boss: "WRONG FLAG",
    sentence: "I ___ Mexican and I ___ from Guadalajara, but now I ___ in Medan, Indonesia.",
    options: ["am / am / am", "am / is / are", "is / am / am"],
    correctIndex: 0,
    tip: "Con I siempre usamos AM en todas."
  },
  {
    type: "affirm",
    boss: "YOU IS?",
    sentence: "You ___ Indonesian and you ___ from Medan, but now you ___ online in class.",
    options: ["am / are / is", "are / are / are", "are / is / are"],
    correctIndex: 1,
    tip: "You -> ARE, ARE, ARE."
  },
  {
    type: "neg",
    boss: "FAKE COUNTRY",
    sentence: "She ___ not Mexican, she ___ Indonesian and she ___ from Jakarta.",
    options: ["is / is / are", "is / is / is", "are / is / is"],
    correctIndex: 1,
    tip: "She -> IS / IS / IS."
  },
  {
    type: "neg",
    boss: "NOT FROM HERE",
    sentence: "We ___ not from Spain, we ___ from Colombia and we ___ very happy.",
    options: ["are / are / are", "am / are / are", "are / is / are"],
    correctIndex: 0,
    tip: "We -> ARE en las tres."
  },
  {
    type: "inter",
    boss: "QUESTION BUG",
    sentence: "___ you Mexican or Colombian? Where ___ you from exactly?",
    options: ["Are / are", "Am / are", "Are / is"],
    correctIndex: 0,
    tip: "You -> ARE, y despues ARE otra vez."
  },
  {
    type: "inter",
    boss: "MIXED FLAGS",
    sentence: "___ she Indonesian or Malaysian? Where ___ she now?",
    options: ["Is / is", "Are / is", "Is / are"],
    correctIndex: 0,
    tip: "She -> IS / IS."
  },
  {
    type: "mixed",
    boss: "CONFUSED PLAYER",
    sentence: "They ___ Brazilian, they ___ from Rio, but now they ___ in Mexico.",
    options: ["are / are / are", "is / are / are", "are / is / are"],
    correctIndex: 0,
    tip: "They -> ARE en todas."
  },
  {
    type: "mixed",
    boss: "NATIONALITY GLITCH",
    sentence: "I ___ not American, I ___ Mexican and I ___ a gamer from Latin America.",
    options: ["am / am / am", "am / is / am", "is / am / am"],
    correctIndex: 0,
    tip: "Con I, otra vez: AM, AM, AM."
  }
];

state.totalQuestions = quizQuestions.length;

// ==== UTILIDADES DIBUJO ====
function clearScreen() {
  ctx.fillStyle = COLORS.bg;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function drawFrame() {
  ctx.fillStyle = COLORS.darker;
  ctx.fillRect(4, 4, canvas.width - 8, canvas.height - 8);
  ctx.fillStyle = COLORS.bg;
  ctx.fillRect(8, 8, canvas.width - 16, canvas.height - 16);
}

function drawText(lines, x, y, lineHeight = 12) {
  ctx.fillStyle = COLORS.text;
  ctx.font = "10px monospace";
  for (let i = 0; i < lines.length; i++) {
    ctx.fillText(lines[i], x, y + i * lineHeight);
  }
}

// ==== SPRITES SIMPLES (player y boss) ====
function drawPlayer(x, y) {
  ctx.fillStyle = COLORS.darker;
  ctx.fillRect(x, y - 12, 10, 10); // cabeza
  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(x - 2, y - 2, 14, 12); // torso
  ctx.fillRect(x - 2, y + 10, 4, 8);  // pierna izq
  ctx.fillRect(x + 8, y + 10, 4, 8);  // pierna der

  // banderita simple en mano
  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(x + 12, y - 6, 2, 10);
  ctx.fillStyle = COLORS.light;
  ctx.fillRect(x + 14, y - 6, 6, 6);
}

function drawBossMonster(label, x, y) {
  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(x, y - 10, 52, 26);
  ctx.fillStyle = COLORS.bg;
  ctx.fillRect(x + 6, y - 6, 8, 8);
  ctx.fillRect(x + 38, y - 6, 8, 8);
  ctx.fillStyle = COLORS.light;
  ctx.font = "7px monospace";
  ctx.fillText(label, x + 4, y + 16);
}

// ==== PANTALLAS ====
function renderTitle() {
  clearScreen();
  drawFrame();

  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(34, 34, 252, 40);

  ctx.fillStyle = COLORS.light;
  ctx.font = "15px monospace";
  ctx.fillText("NATIONQUEST", 70, 60);

  ctx.font = "10px monospace";
  ctx.fillText("Verb To Be + Nationalities", 54, 78);

  const lines = [
    "",
    "Aprende a decir quien eres,",
    "de que pais y ciudad,",
    "usando solo VERB TO BE.",
    "",
    "Frases cortas y largas,",
    "perfectas para presentarte",
    "en entrevistas y clases.",
    "",
    "PC: ENTER para empezar.",
    "M√≥vil: toca OK."
  ];
  drawText(lines, 30, 110);
}

function renderStory() {
  clearScreen();
  drawFrame();
  drawText(storyPages[state.storyPage], 18, 26);
  ctx.font = "9px monospace";
  ctx.fillText("Historia", 12, 20);

  // Player sprite global
  drawPlayer(260, 170);
}

function renderExplainBlock(block, label) {
  clearScreen();
  drawFrame();
  drawText(block[state.explainPage], 18, 26);
  ctx.font = "9px monospace";
  ctx.fillText(label, 12, 20);

  // peque√±o icono pasaporte
  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(260, 180, 28, 18);
  ctx.fillStyle = COLORS.light;
  ctx.fillRect(262, 182, 12, 14);
  ctx.fillStyle = COLORS.dark;
  ctx.font = "7px monospace";
  ctx.fillText("ID", 265, 193);
}

function renderQuiz() {
  clearScreen();
  drawFrame();

  const q = quizQuestions[state.quizIndex];

  // Titulo
  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(12, 14, 296, 20);
  ctx.fillStyle = COLORS.light;
  ctx.font = "10px monospace";
  ctx.fillText("Boss Fight ¬∑ Nationalities", 20, 28);

  // Player vs Boss
  drawPlayer(40, 150);
  drawBossMonster(q.boss, 205, 125);

  // Pregunta
  ctx.fillStyle = COLORS.text;
  ctx.font = "10px monospace";
  // Rompemos un poco la oracion larga si es necesario
  const parts = q.sentence.split(".");
  let yBase = 68;
  for (let i = 0; i < parts.length; i++) {
    const line = parts[i].trim();
    if (!line) continue;
    ctx.fillText(line + (i < parts.length - 1 ? "." : ""), 18, yBase);
    yBase += 12;
  }

  // Opciones
  ctx.font = "10px monospace";
  for (let i = 0; i < q.options.length; i++) {
    const isSelected = (i === state.selectionIndex);
    const y = 120 + i * 20;

    if (isSelected) {
      ctx.fillStyle = COLORS.dark;
      ctx.fillRect(40, y - 12, 240, 18);
      ctx.fillStyle = COLORS.light;
      ctx.fillText("> " + q.options[i], 48, y);
    } else {
      ctx.fillStyle = COLORS.text;
      ctx.fillText("  " + q.options[i], 48, y);
    }
  }

  // Progreso y tip
  ctx.font = "9px monospace";
  ctx.fillStyle = COLORS.dark;
  ctx.fillText(
    `Pregunta ${state.quizIndex + 1}/${state.totalQuestions}`,
    18,
    196
  );

  ctx.fillStyle = COLORS.text;
  ctx.fillText(q.tip, 18, 212);
  ctx.fillText("ENTER/OK = responder", 18, 228);
}

function renderSummary() {
  clearScreen();
  drawFrame();

  const percent = Math.round((state.score / state.totalQuestions) * 100);

  // Guardar mejor puntuaci√≥n simple
  try {
    const prev = parseInt(localStorage.getItem("nationquest_best") || "0", 10);
    if (!isNaN(prev) && percent > prev) {
      localStorage.setItem("nationquest_best", String(percent));
    } else if (isNaN(prev)) {
      localStorage.setItem("nationquest_best", String(percent));
    }
  } catch (e) {}

  let best = 0;
  try {
    best = parseInt(localStorage.getItem("nationquest_best") || "0", 10);
  } catch (e) {
    best = percent;
  }

  const lines = [
    "FIN DE NATIONQUEST",
    "",
    `Puntaje: ${state.score} / ${state.totalQuestions}`,
    `Aciertos: ${percent}%`,
    `Mejor marca: ${best}%`,
    "",
    percent === 100
      ? "Perfecto, tu pasaporte ingles",
      : percent >= 75
      ? "Muy bien, ya puedes decir",
      : "Repite el juego y memoriza",
    percent === 100
      ? "esta listo para el mundo."
      : percent >= 75
      ? "quien eres y de donde eres."
      : "las estructuras mas largas.",
    "",
    "Idea de practica:",
    "Presentate siempre asi:",
    "I'm Mexican, I'm from X,",
    "but now I'm in Y.",
    "",
    "ENTER/OK = Volver al titulo"
  ];
  drawText(lines, 26, 40);
}

// ==== FLASH MENSAJE ====
let flashText = "";
let flashTimer = 0;

function flashMessage(msg) {
  flashText = msg;
  flashTimer = 60; // frames
}

// ==== LOOP PRINCIPAL ====
function mainLoop() {
  switch (state.screen) {
    case SCREENS.TITLE:
      renderTitle();
      break;
    case SCREENS.STORY:
      renderStory();
      break;
    case SCREENS.EXPLAIN_AFFIRM:
      renderExplainBlock(explainAffirm, "Libro 1 ¬∑ Afirmativo + pais");
      break;
    case SCREENS.EXPLAIN_NEG:
      renderExplainBlock(explainNeg, "Libro 2 ¬∑ Negativo");
      break;
    case SCREENS.EXPLAIN_INTER:
      renderExplainBlock(explainInter, "Libro 3 ¬∑ Preguntas");
      break;
    case SCREENS.QUIZ:
      renderQuiz();
      break;
    case SCREENS.SUMMARY:
      renderSummary();
      break;
  }

  if (flashTimer > 0) {
    ctx.fillStyle = COLORS.darker;
    ctx.fillRect(0, canvas.height - 24, canvas.width, 24);
    ctx.fillStyle = COLORS.light;
    ctx.font = "10px monospace";
    ctx.fillText(flashText, 8, canvas.height - 8);
    flashTimer--;
  }

  requestAnimationFrame(mainLoop);
}
requestAnimationFrame(mainLoop);

// ==== CONTROL UNIFICADO (teclado/touch) ====
function handleControl(action) {
  if (!audioCtx && (action === "up" || action === "down" || action === "ok")) {
    initAudio();
  }

  // TITULO
  if (state.screen === SCREENS.TITLE) {
    if (action === "ok") {
      playBeep("ok");
      state.screen = SCREENS.STORY;
      state.storyPage = 0;
    } else if (action === "up" || action === "down") {
      playBeep("move");
    }
    return;
  }

  // HISTORIA
  if (state.screen === SCREENS.STORY) {
    if (action === "ok") {
      playBeep("ok");
      if (state.storyPage < storyPages.length - 1) {
        state.storyPage++;
      } else {
        state.screen = SCREENS.EXPLAIN_AFFIRM;
        state.explainPage = 0;
      }
    }
    return;
  }

  // EXPLICACIONES
  if (
    state.screen === SCREENS.EXPLAIN_AFFIRM ||
    state.screen === SCREENS.EXPLAIN_NEG ||
    state.screen === SCREENS.EXPLAIN_INTER
  ) {
    if (action === "ok") {
      playBeep("ok");
      const maxPage =
        state.screen === SCREENS.EXPLAIN_AFFIRM
          ? explainAffirm.length
          : state.screen === SCREENS.EXPLAIN_NEG
          ? explainNeg.length
          : explainInter.length;

      if (state.explainPage < maxPage - 1) {
        state.explainPage++;
      } else {
        if (state.screen === SCREENS.EXPLAIN_AFFIRM) {
          state.screen = SCREENS.EXPLAIN_NEG;
          state.explainPage = 0;
        } else if (state.screen === SCREENS.EXPLAIN_NEG) {
          state.screen = SCREENS.EXPLAIN_INTER;
          state.explainPage = 0;
        } else {
          state.screen = SCREENS.QUIZ;
          state.selectionIndex = 0;
        }
      }
    }

    if (action === "skip") {
      playBeep("bad");
      state.screen = SCREENS.QUIZ;
      state.selectionIndex = 0;
    }
    return;
  }

  // QUIZ
  if (state.screen === SCREENS.QUIZ) {
    const q = quizQuestions[state.quizIndex];

    if (action === "up") {
      state.selectionIndex =
        (state.selectionIndex - 1 + q.options.length) % q.options.length;
      playBeep("move");
    } else if (action === "down") {
      state.selectionIndex =
        (state.selectionIndex + 1) % q.options.length;
      playBeep("move");
    } else if (action === "ok") {
      if (state.selectionIndex === q.correctIndex) {
        state.score++;
        playBeep("good");
        flashMessage("‚úî Correcto, pasaporte sellado.");
      } else {
        playBeep("bad");
        flashMessage(
          `‚úñ Correcto: ${q.options[q.correctIndex]}`
        );
      }

      if (state.quizIndex < quizQuestions.length - 1) {
        state.quizIndex++;
        state.selectionIndex = 0;
      } else {
        state.screen = SCREENS.SUMMARY;
      }
    }
    return;
  }

  // SUMMARY
  if (state.screen === SCREENS.SUMMARY) {
    if (action === "ok") {
      playBeep("ok");
      state.screen = SCREENS.TITLE;
      state.selectionIndex = 0;
      state.storyPage = 0;
      state.explainPage = 0;
      state.quizIndex = 0;
      state.score = 0;
    }
  }
}

// Teclado
window.addEventListener("keydown", (e) => {
  const key = e.key;

  if (key === "ArrowUp") {
    handleControl("up");
  } else if (key === "ArrowDown") {
    handleControl("down");
  } else if (key === "Enter") {
    handleControl("ok");
  } else if (key === "Escape") {
    handleControl("skip");
  }
});

// Touch
document.querySelectorAll(".btn-control").forEach(btn => {
  const action = btn.getAttribute("data-action");
  if (!action) return;

  const fire = (ev) => {
    ev.preventDefault();
    handleControl(action);
  };

  btn.addEventListener("click", fire);
  btn.addEventListener("touchstart", fire, { passive: false });
});
</script>
</body>
</html>
