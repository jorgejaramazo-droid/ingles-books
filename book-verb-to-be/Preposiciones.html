<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Chrono-Spatial: Ultimate Prepositions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    /* ================= ESTILO CYBERPUNK GBA ================= */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; user-select: none; }
    
    body {
      margin: 0; padding: 0;
      background: #050510; /* Negro profundo */
      /* Rejilla Neon */
      background-image: linear-gradient(rgba(0, 242, 255, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 0, 128, 0.1) 1px, transparent 1px);
      background-size: 40px 40px;
      display: flex; justify-content: center; align-items: center;
      height: 100vh; overflow: hidden;
      font-family: 'Courier New', Courier, monospace;
      color: #eee;
    }

    #game-container {
      display: flex; flex-direction: column; align-items: center;
      transform: scale(1); transition: transform 0.2s;
    }

    /* Consola Cyber */
    #console-body {
      background: #2d3436;
      padding: 15px 30px;
      border-radius: 10px 10px 40px 10px;
      box-shadow: 
        0 0 15px rgba(0, 242, 255, 0.2),
        inset 0 0 20px rgba(0,0,0,0.8);
      border: 2px solid #00f2ff; /* Borde Ne√≥n Cian */
      width: 360px;
      display: flex; flex-direction: column; align-items: center;
    }

    /* Pantalla */
    #screen-border {
      background: #000;
      padding: 15px 35px;
      border-radius: 5px;
      margin-bottom: 20px;
      width: 100%;
      border: 1px solid #333;
      display: flex; flex-direction: column; align-items: center;
      position: relative;
    }

    .brand-logo {
      color: #00f2ff; font-family: sans-serif; font-style: italic; font-weight: 800; font-size: 14px;
      margin-bottom: 5px; width: 100%; text-align: center; text-shadow: 0 0 5px #00f2ff;
      letter-spacing: 2px;
    }

    canvas {
      background: #000; /* Pantalla negra OLED */
      border: 2px solid #555;
      image-rendering: pixelated;
    }

    /* === CONTROLES === */
    .controls-area {
      display: flex; justify-content: space-between; width: 100%; align-items: flex-end; padding-bottom: 10px;
    }

    /* D-PAD Neon */
    .dpad {
      width: 90px; height: 90px; position: relative;
    }
    .dpad-bg { position: absolute; background: #111; border: 1px solid #444; border-radius: 4px; }
    .d-v { left: 30px; top: 0; width: 30px; height: 90px; }
    .d-h { left: 0; top: 30px; width: 90px; height: 30px; }
    .d-c { left: 30px; top: 30px; width: 30px; height: 30px; background: #222; border-radius: 50%; z-index:2; }

    /* Touch Zones */
    .btn-touch { position: absolute; z-index: 10; cursor: pointer; }
    .t-up { top:0; left:0; width:100%; height:45%; }
    .t-down { bottom:0; left:0; width:100%; height:45%; }

    /* Botones A/B Neon */
    .ab-group { display: flex; gap: 15px; margin-bottom: 15px; }
    .btn-action {
      width: 45px; height: 45px; border-radius: 50%;
      background: #ff0055; /* Rosa Ne√≥n */
      box-shadow: 0 0 10px #ff0055;
      color: #fff; display: flex; justify-content: center; align-items: center;
      font-weight: bold; font-family: sans-serif; cursor: pointer;
      border: 2px solid #ff5e99;
    }
    .btn-action:active { transform: scale(0.95); box-shadow: 0 0 5px #ff0055; }

    /* Start/Select */
    .meta-btns { display: flex; gap: 10px; margin-bottom: 5px; }
    .btn-small {
      width: 40px; height: 12px; background: #333; border-radius: 6px;
      transform: rotate(-15deg); border: 1px solid #555; cursor: pointer;
    }

    #meta-info { margin-top: 10px; font-size: 10px; color: #555; font-family: sans-serif; text-align: center; }

    @media (max-width: 400px) { #game-container { transform: scale(0.85); } }
  </style>
</head>
<body>

<div id="game-container">
  <div id="console-body">
    
    <div id="screen-border">
      <div class="brand-logo">CYBER SPACE</div>
      <canvas id="game" width="280" height="180"></canvas>
    </div>

    <div class="controls-area">
      <div class="dpad">
        <div class="dpad-bg d-v"></div>
        <div class="dpad-bg d-h"></div>
        <div class="dpad-bg d-c"></div>
        <div class="btn-touch t-up" id="btn-up"></div>
        <div class="btn-touch t-down" id="btn-down"></div>
      </div>

      <div style="display:flex; flex-direction:column; align-items:center;">
         <div class="meta-btns">
            <div class="btn-small" id="btn-select"></div>
            <div class="btn-small" id="btn-start"></div>
         </div>
         <div style="font-size:8px; color:#555; margin-top:2px; font-weight:bold;">SELECT START</div>
      </div>

      <div class="ab-group">
        <div class="btn-action" id="btn-b">B</div>
        <div class="btn-action" id="btn-a">A</div>
      </div>
    </div>

  </div>
  <div id="meta-info">APRENDE INGL√âS YA<br>Cyber Edition ¬∑ J. Jaramillo</div>
</div>

<script>
(function() {
  const canvas = document.getElementById("game");
  if(!canvas) return;
  const ctx = canvas.getContext("2d");

  // Paleta Cyberpunk
  const C = { 
    bg: "#000000",
    text: "#00f2ff",   // Cian Brillante
    accent: "#ff0055", // Rosa Ne√≥n
    dim: "#555555",
    white: "#ffffff",
    green: "#00ff00"
  };

  const SCREENS = { TITLE: 0, THEORY: 1, QUIZ: 2, END: 3 };

  let state = {
    screen: SCREENS.TITLE,
    page: 0,
    qIndex: 0,
    selIndex: 0,
    score: 0,
    msg: "",
    timer: 0,
    frame: 0
  };

  // --- AUDIO ---
  let audioCtx = null;
  function sfx(type) {
    try {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      const now = audioCtx.currentTime;

      // Sonidos "Digitales"
      if(type==='nav') { osc.type='square'; osc.frequency.setValueAtTime(150, now); osc.stop(now+0.05); }
      if(type==='ok') { osc.type='sine'; osc.frequency.setValueAtTime(800, now); osc.frequency.exponentialRampToValueAtTime(1200, now+0.1); osc.stop(now+0.1); }
      if(type==='win') { osc.type='square'; osc.frequency.setValueAtTime(600, now); osc.frequency.setValueAtTime(1200, now+0.1); osc.stop(now+0.2); }
      if(type==='bad') { osc.type='sawtooth'; osc.frequency.setValueAtTime(100, now); osc.frequency.linearRampToValueAtTime(50, now+0.3); osc.stop(now+0.3); }

      gain.gain.setValueAtTime(0.05, now);
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.start();
    } catch(e){}
  }

  // --- CONTENIDO COMPLETO ---
  
  const theory = [
    { 
      title: "1. TIME: THE BIG 3", 
      lines: [
        "AT üïí: Precise time",
        "   At 5:00. At night.",
        "ON üìÖ: Days / Dates",
        "   On Monday. On July 4th.",
        "IN üóìÔ∏è: Months / Years",
        "   In July. In 2025. In the morning."
      ] 
    },
    { 
      title: "2. PLACE: POSITION", 
      lines: [
        "IN üì¶: Inside (Enclosed)",
        "   In the box. In Paris.",
        "ON „Ä∞Ô∏è: Surface",
        "   On the table. On the wall.",
        "AT üìç: Point",
        "   At the door. At the bus stop."
      ] 
    },
    { 
      title: "3. RELATIVE POSITIONS", 
      lines: [
        "‚¨ÜÔ∏è OVER / ABOVE (Encima)",
        "‚¨áÔ∏è UNDER / BELOW (Debajo)",
        "‚¨ÖÔ∏è BEHIND (Detr√°s)",
        "‚û°Ô∏è IN FRONT OF (Delante)",
        "‚ÜîÔ∏è BETWEEN (Entre 2 cosas)",
        "üìç NEXT TO (Al lado)"
      ] 
    },
    { 
      title: "4. TIME & MOVEMENT", 
      lines: [
        "‚è≥ DURING (Durante)",
        "üõë UNTIL (Hasta)",
        "‚èÆÔ∏è BEFORE (Antes)",
        "‚è≠Ô∏è AFTER (Despu√©s)",
        "üö∂ THROUGH (A trav√©s de)",
        "üõ£Ô∏è ACROSS (Cruzando)"
      ] 
    }
  ];

  const questions = [
    // --- TIME: IN/ON/AT ---
    { q: "See you ___ Monday. üìÖ", opts: ["in", "on", "at"], ans: 1, tip: "D√≠as = ON." },
    { q: "My birthday is ___ May. üóìÔ∏è", opts: ["in", "on", "at"], ans: 0, tip: "Meses = IN." },
    { q: "The class is ___ 9:00 AM. üïí", opts: ["on", "in", "at"], ans: 2, tip: "Hora exacta = AT." },
    { q: "We sleep ___ night. üåô", opts: ["in", "on", "at"], ans: 2, tip: "Excepci√≥n: AT night." },
    { q: "He was born ___ 1990. üìÖ", opts: ["on", "at", "in"], ans: 2, tip: "A√±os = IN." },

    // --- PLACE: IN/ON/AT ---
    { q: "The keys are ___ the table. üîë", opts: ["in", "on", "at"], ans: 1, tip: "Superficie = ON." },
    { q: "She is ___ the kitchen. üç≥", opts: ["at", "on", "in"], ans: 2, tip: "Dentro de cuarto = IN." },
    { q: "Wait ___ the bus stop. üöè", opts: ["on", "in", "at"], ans: 2, tip: "Punto espec√≠fico = AT." },
    { q: "The picture is ___ the wall. üñºÔ∏è", opts: ["in", "at", "on"], ans: 2, tip: "Superficie vertical = ON." },

    // --- POSITION (Under, Over, etc) ---
    { q: "The cat is ___ the table. (üëá)", opts: ["over", "under", "on"], ans: 1, tip: "Abajo = UNDER." },
    { q: "The plane flies ___ the city. (‚úàÔ∏è)", opts: ["under", "over", "in"], ans: 1, tip: "Sobre/Encima = OVER." },
    { q: "A is ___ B and C. (A B C)", opts: ["between", "next", "behind"], ans: 0, tip: "En medio = BETWEEN." },
    { q: "The garden is ___ the house. (üîô)", opts: ["behind", "front", "in"], ans: 0, tip: "Atr√°s = BEHIND." },
    { q: "Sit ___ me. (üë´)", opts: ["next to", "between", "under"], ans: 0, tip: "Al lado = NEXT TO." },

    // --- MOVEMENT & TIME FLOW ---
    { q: "Wash hands ___ eating. (üçΩÔ∏è)", opts: ["after", "before", "until"], ans: 1, tip: "Antes = BEFORE." },
    { q: "I work from 9 ___ 5. (‚è∞)", opts: ["until", "to", "at"], ans: 1, tip: "FROM... TO..." },
    { q: "Wait ___ tomorrow. (üõë)", opts: ["during", "until", "on"], ans: 1, tip: "Hasta = UNTIL." },
    { q: "Don't talk ___ the movie. (ü§´)", opts: ["during", "while", "at"], ans: 0, tip: "Durante + Sustantivo = DURING." },
    { q: "Walk ___ the door. (üö™)", opts: ["across", "through", "on"], ans: 1, tip: "Atravesar = THROUGH." },
    
    // --- ADVANCED MIX ---
    { q: "The bridge goes ___ the river.", opts: ["across", "through", "between"], ans: 0, tip: "Cruzar superficie = ACROSS." },
    { q: "The lamp is ___ the sofa.", opts: ["above", "on", "in"], ans: 0, tip: "Arriba (sin tocar) = ABOVE." },
    { q: "She is sitting ___ of me.", opts: ["front", "in front", "opposite"], ans: 1, tip: "Delante = IN FRONT OF." },
    { q: "We live ___ London.", opts: ["at", "on", "in"], ans: 2, tip: "Ciudad = IN." },
    { q: "The party is ___ Friday ___ 8pm.", opts: ["on / at", "in / on", "at / on"], ans: 0, tip: "D√≠a (ON) + Hora (AT)." }
  ];

  // --- RENDER ---
  function drawText(txt, x, y, size=12, align="center", color=C.text) {
    ctx.fillStyle = color; ctx.font = "bold "+size+"px monospace"; ctx.textAlign = align;
    ctx.fillText(txt, x, y);
  }

  function render() {
    state.frame++;
    ctx.fillStyle = C.bg; ctx.fillRect(0,0,canvas.width,canvas.height);

    // Matrix Rain Effect (Fondo decorativo)
    ctx.fillStyle = "rgba(0, 242, 255, 0.1)";
    for(let i=0; i<10; i++) {
       let x = (i * 30 + state.frame) % 280;
       let y = (state.frame * 2 + i * 50) % 180;
       ctx.fillText(String.fromCharCode(0x30A0 + i), x, y);
    }

    if(state.screen === SCREENS.TITLE) {
      drawText("CHRONO-SPATIAL", 140, 60, 20, "center", C.text);
      drawText("CYBER EDITION", 140, 80, 12, "center", C.accent);
      
      drawText("ALL PREPOSITIONS", 140, 110, 10, "center", C.white);
      drawText("IN ON AT UNDER BEFORE...", 140, 125, 8, "center", C.dim);

      if(Math.floor(state.frame/30)%2===0) {
        drawText("> PRESS START <", 140, 160, 12, "center", C.accent);
      }
    }
    
    else if(state.screen === SCREENS.THEORY) {
      const p = theory[state.page];
      // Header Neon
      ctx.fillStyle = C.text; ctx.fillRect(0,0,canvas.width,25);
      drawText(p.title, 140, 17, 12, "center", C.bg);

      let y = 50;
      ctx.textAlign = "left";
      p.lines.forEach(l => {
        if(l.includes(":") || l.includes("‚¨ÜÔ∏è")) ctx.fillStyle = C.accent;
        else ctx.fillStyle = C.white;
        
        ctx.font = "11px monospace";
        ctx.fillText(l, 10, y);
        y += 18;
      });

      drawText("A: NEXT >>", 270, 170, 10, "right", C.text);
    }
    
    else if(state.screen === SCREENS.QUIZ) {
      const q = questions[state.qIndex];
      
      // HUD
      ctx.fillStyle = "#111"; ctx.fillRect(0,0,canvas.width,20);
      drawText(`Q:${state.qIndex+1}/${questions.length}`, 10, 14, 10, "left", C.white);
      drawText(`SCORE:${state.score}`, 270, 14, 10, "right", C.white);

      // Box border neon
      ctx.strokeStyle = C.text; ctx.strokeRect(10,30,260,50);
      const fontSize = q.q.match(/[\uD800-\uDBFF]/) ? 16 : 14;
      drawText(q.q, 140, 60, fontSize, "center", C.white);

      // Options
      const startY = 95;
      q.opts.forEach((opt, i) => {
        const isSel = i === state.selIndex;
        if(isSel) {
          ctx.fillStyle = C.accent; ctx.fillRect(20, startY + (i*28)-16, 240, 24);
          drawText(opt.toUpperCase(), 140, startY + (i*28), 12, "center", "#fff");
        } else {
          drawText(opt.toUpperCase(), 140, startY + (i*28), 12, "center", C.dim);
        }
      });

      // Feedback
      if(state.timer > 0) {
        const isCor = state.msg === "CORRECT!";
        ctx.fillStyle = isCor ? "#000" : "#300";
        ctx.fillRect(0, 50, 280, 80);
        ctx.strokeStyle = isCor ? C.green : C.accent;
        ctx.strokeRect(2, 52, 276, 76);

        drawText(state.msg, 140, 85, 20, "center", isCor ? C.green : C.accent);
        if(!isCor) {
           drawText("TIP:", 140, 105, 10, "center", "#fff");
           drawText(q.tip, 140, 120, 10, "center", C.text);
        }
      }
    }

    else if(state.screen === SCREENS.END) {
      drawText("SYSTEM SYNCHRONIZED", 140, 50, 16, "center", C.text);
      const pct = Math.floor((state.score/questions.length)*100);
      drawText(`DATA: ${state.score} PTS`, 140, 80, 14, "center", C.white);
      
      let rank = "GLITCH üëæ";
      if(pct > 50) rank = "CYBORG ü§ñ";
      if(pct > 80) rank = "HACKER üíª";
      if(pct === 100) rank = "AI GOD üß†";

      drawText(rank, 140, 120, 16, "center", C.accent);
      drawText("PRESS A TO REBOOT", 140, 160, 10, "center", C.dim);
    }
  }

  // --- LOGIC ---
  function loop() {
    if(state.timer > 0) {
      state.timer--;
      if(state.timer===0) {
        if(state.qIndex < questions.length-1) { state.qIndex++; state.selIndex=0; }
        else { state.screen = SCREENS.END; }
      }
    }
    render();
    requestAnimationFrame(loop);
  }

  function input(key) {
    if(state.timer > 0) return;

    if(state.screen === SCREENS.TITLE) {
      if(key==='a' || key==='start') { sfx('ok'); state.screen = SCREENS.THEORY; }
    }
    else if(state.screen === SCREENS.THEORY) {
      if(key==='a') {
        sfx('nav');
        if(state.page < theory.length-1) state.page++;
        else { sfx('ok'); state.screen=SCREENS.QUIZ; state.qIndex=0; state.score=0; }
      }
      if(key==='select') { sfx('ok'); state.screen=SCREENS.QUIZ; state.qIndex=0; state.score=0; }
    }
    else if(state.screen === SCREENS.QUIZ) {
      if(key==='up') { sfx('nav'); state.selIndex = (state.selIndex-1+3)%3; }
      if(key==='down') { sfx('nav'); state.selIndex = (state.selIndex+1)%3; }
      if(key==='a') {
        const q = questions[state.qIndex];
        if(state.selIndex === q.ans) {
          state.score++; state.msg="CORRECT!"; sfx('win'); state.timer=50;
        } else {
          state.msg="WRONG!"; sfx('bad'); state.timer=120;
        }
      }
    }
    else if(state.screen === SCREENS.END) {
      if(key==='a') location.reload();
    }
  }

  // --- EVENTS ---
  function bind(id, k) {
    const el = document.getElementById(id);
    if(el) {
      el.addEventListener('mousedown', (e)=>{e.preventDefault(); input(k);});
      el.addEventListener('touchstart', (e)=>{e.preventDefault(); input(k);}, {passive:false});
    }
  }
  bind('btn-up','up'); bind('btn-down','down');
  bind('btn-a','a'); bind('btn-b','b');
  bind('btn-start','start'); bind('btn-select','select');

  window.addEventListener('keydown', e => {
    if(e.key==="ArrowUp") input('up');
    if(e.key==="ArrowDown") input('down');
    if(e.key==="Enter" || e.key==="z") input('a');
    if(e.key==="Shift") input('select');
  });

  requestAnimationFrame(loop);
})();
</script>
</body>
</html>