<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Verb To Be - Game Boy Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #222 0, #050505 60%);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: #eee;
      overflow: hidden;
    }

    #game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      transform: scale(1);
    }

    #gameboy-frame {
      padding: 16px 16px 20px;
      border-radius: 26px;
      background: linear-gradient(145deg, #333, #111);
      box-shadow:
        0 20px 40px rgba(0,0,0,0.7),
        inset 0 0 10px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      border: 2px solid #555;
    }

    #title-strip {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #e5f5d0;
      font-size: 11px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
    }

    #title-main {
      font-weight: 700;
    }

    #title-sub {
      font-size: 9px;
      opacity: 0.8;
    }

    #status-bar {
      width: 100%;
      font-size: 9px;
      text-align: right;
      color: #9ac7a0;
      opacity: 0.9;
    }

    canvas {
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      border-radius: 8px;
      border: 4px solid #3f5b41;
      background: #99c98c; /* verde tipo Game Boy */
    }

    #controls-label {
      font-size: 10px;
      text-align: center;
      color: #bbb;
    }

    /* Controles tÃ¡ctiles */
    #touch-controls {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      user-select: none;
    }

    .touch-row {
      display: flex;
      gap: 6px;
      justify-content: center;
    }

    .btn-control {
      width: 54px;
      height: 34px;
      border-radius: 16px;
      border: 2px solid #444;
      background: radial-gradient(circle at top, #666 0, #222 65%);
      color: #f5f5f5;
      font-size: 11px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow:
        0 4px 0 #000,
        0 6px 12px rgba(0,0,0,0.7);
      cursor: pointer;
      transition: transform 0.05s ease, box-shadow 0.05s ease, background 0.05s ease;
    }

    .btn-control:active {
      transform: translateY(3px);
      box-shadow:
        0 1px 0 #000,
        0 4px 8px rgba(0,0,0,0.6);
      background: radial-gradient(circle at top, #777 0, #333 65%);
    }

    .btn-small {
      width: 60px;
      height: 26px;
      border-radius: 20px;
      font-size: 9px;
    }

    #meta-info {
      margin-top: 3px;
      font-size: 9px;
      color: #777;
      text-align: center;
    }

    @media (max-width: 480px) {
      #game-container {
        transform: scale(0.9);
      }
    }

    @media (max-width: 380px) {
      #game-container {
        transform: scale(0.8);
      }
    }
  </style>
</head>
<body>
<div id="game-container">
  <div id="gameboy-frame">
    <div id="title-strip">
      <span id="title-main">Verb To Be Â· Game Boy</span>
      <span id="title-sub">Hispanohablantes A1</span>
    </div>
    <div id="status-bar">
      ðŸ‘¾ Mundo: GramariON
    </div>

    <canvas id="game" width="320" height="240"></canvas>

    <div id="controls-label">
      PC: â–²â–¼ + ENTER Â· ESC &nbsp;|&nbsp; MÃ³vil: botones tÃ¡ctiles
    </div>

    <div id="touch-controls">
      <div class="touch-row">
        <div class="btn-control" data-action="up">â–²</div>
      </div>
      <div class="touch-row">
        <div class="btn-control" data-action="down">â–¼</div>
        <div class="btn-control" data-action="ok">OK</div>
        <div class="btn-control btn-small" data-action="skip">SKIP</div>
      </div>
    </div>
  </div>

  <div id="meta-info">
    Aprende InglÃ©s Ya Â· Verb To Be Quest
  </div>
</div>

<script>
/* =====================================================
   GAME BOY VERB TO BE â€” PARA HISPANOHABLANTES
   Pantalla 320x240, estilo mini consola
   Con soporte teclado + touch + sonidos arcade
   ===================================================== */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Paleta verde tipo Game Boy
const COLORS = {
  bg: "#99c98c",
  dark: "#436646",
  darker: "#2b4530",
  light: "#cfe9c0",
  text: "#102010",
  accent: "#213921"
};

// Estados del juego
const SCREENS = {
  TITLE: "title",
  STORY: "story",
  EXPLAIN_AFFIRM: "explain_affirm",
  EXPLAIN_NEG: "explain_neg",
  EXPLAIN_INTER: "explain_inter",
  QUIZ: "quiz",
  SUMMARY: "summary"
};

let state = {
  screen: SCREENS.TITLE,
  selectionIndex: 0,
  storyPage: 0,
  explainPage: 0,
  quizIndex: 0,
  score: 0,
  totalQuestions: 0
};

// ==== AUDIO ARCADE SIMPLE (sin archivos externos) ====
let audioCtx = null;

function initAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playBeep(type = "move") {
  if (!audioCtx) return;

  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  let freq = 440;
  let duration = 0.09;

  if (type === "move") {
    freq = 520;
    duration = 0.06;
  } else if (type === "ok") {
    freq = 740;
    duration = 0.11;
  } else if (type === "good") {
    freq = 880;
    duration = 0.15;
  } else if (type === "bad") {
    freq = 220;
    duration = 0.18;
  }

  osc.type = "square";
  osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
  gain.gain.setValueAtTime(0.16, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

// Historia tipo libro
const storyPages = [
  [
    "GRAMARION, REINO PIXELADO.",
    "",
    "Eres un estudiante hispano",
    "que quiere dominar el",
    "VERB TO BE.",
    "",
    "Sin este verbo no puedes",
    "entrar a las mazmorras",
    "del ingles real.",
    "",
    "Wizard To-Be te dara un",
    "libro magico y luego",
    "lucharas contra los",
    "monstruos gramaticales:",
    "YOU IS, SHE ARE, IT AM...",
    "",
    "ENTER / OK para continuar."
  ],
  [
    "Wizard To-Be:",
    "",
    "\"TO BE significa SER o",
    "ESTAR. Es el rey de los",
    "verbos. Sin el, tu ingles",
    "se ve roto como un juego",
    "sin parche.\"",
    "",
    "\"Aprende afirmativo,",
    "negativo e interrogativo",
    "y podras corregir a los",
    "Grammar Monsters.\"",
    "",
    "ENTER / OK = Empezar libro."
  ]
];

// Explicaciones
const explainAffirm = [
  [
    "1/2 Â· AFIRMATIVO",
    "",
    "I am   = Yo soy / Yo estoy",
    "You are= Tu eres / estas",
    "He is  = El es / esta",
    "She is = Ella es / esta",
    "It is  = Eso es / esta",
    "We are = Nosotros somos",
    "They are= Ellos son/estan",
    "",
    "En la calle casi siempre",
    "escucharas las formas",
    "contraidas:"
  ],
  [
    "1/2 Â· AFIRMATIVO",
    "",
    "I'm   = I am",
    "You're= You are",
    "He's  = He is",
    "She's = She is",
    "It's  = It is",
    "We're = We are",
    "They're=They are",
    "",
    "Ejemplos gamer:",
    "I'm a gamer.",
    "She's online.",
    "We are in the lobby.",
    "",
    "ENTER/OK = Negativo Â· ESC/SKIP = Saltar"
  ]
];

const explainNeg = [
  [
    "2/2 Â· NEGATIVO",
    "",
    "Estructura:",
    "SUJETO + TO BE + NOT + COMP.",
    "",
    "I am not tired.",
    "You are not ready.",
    "He is not here.",
    "We are not sad.",
    "",
    "Formas contraidas:"
  ],
  [
    "2/2 Â· NEGATIVO",
    "",
    "I'm not   = I am not",
    "You aren't= You are not",
    "He isn't  = He is not",
    "She isn't = She is not",
    "It isn't  = It is not",
    "We aren't = We are not",
    "They aren't=They are not",
    "",
    "Ejemplos gamer:",
    "I'm not offline.",
    "They're not noobs.",
    "",
    "ENTER/OK = Preguntas Â· ESC/SKIP = Saltar"
  ]
];

const explainInter = [
  [
    "3/3 Â· INTERROGATIVO",
    "",
    "Estructura:",
    "TO BE + SUJETO + COMP. ?",
    "",
    "Am I late?",
    "Are you happy?",
    "Is he a teacher?",
    "Are they friends?",
    "",
    "Respuestas cortas:",
    "Yes, I am. / No, I'm not."
  ],
  [
    "3/3 Â· INTERROGATIVO",
    "",
    "Yes, you are. / No, you aren't.",
    "Yes, he is.  / No, he isn't.",
    "Yes, we are. / No, we aren't.",
    "",
    "En espaÃ±ol marcamos la",
    "pregunta con el tono.",
    "",
    "En ingles cambiamos el",
    "orden: primero el TO BE.",
    "",
    "ENTER/OK = Empezar quiz"
  ]
];

// Preguntas tipo boss fight
const quizQuestions = [
  {
    type: "affirm",
    boss: "YOU IS",
    sentence: "I ___ a gamer.",
    options: ["am", "is", "are"],
    correctIndex: 0,
    tip: "Con I siempre usamos AM."
  },
  {
    type: "affirm",
    boss: "SHE ARE",
    sentence: "She ___ my friend.",
    options: ["am", "is", "are"],
    correctIndex: 1,
    tip: "She -> IS."
  },
  {
    type: "neg",
    boss: "IT AM",
    sentence: "It ___ not dangerous.",
    options: ["am", "is", "are"],
    correctIndex: 1,
    tip: "It -> IS / ISN'T."
  },
  {
    type: "neg",
    boss: "WE IS",
    sentence: "We ___ not sad.",
    options: ["am", "is", "are"],
    correctIndex: 2,
    tip: "We -> ARE / AREN'T."
  },
  {
    type: "inter",
    boss: "YOU IS?",
    sentence: "___ you ready?",
    options: ["Am", "Is", "Are"],
    correctIndex: 2,
    tip: "You -> ARE you...?"
  },
  {
    type: "inter",
    boss: "HE ARE?",
    sentence: "___ he your teacher?",
    options: ["Am", "Is", "Are"],
    correctIndex: 1,
    tip: "He -> IS he...?"
  },
  {
    type: "mixed",
    boss: "THEY IS",
    sentence: "They ___ online.",
    options: ["am", "is", "are"],
    correctIndex: 2,
    tip: "They -> ARE."
  },
  {
    type: "mixed",
    boss: "WE ISN'T",
    sentence: "We ___ not noobs.",
    options: ["am", "is", "are"],
    correctIndex: 2,
    tip: "We aren't..."
  }
];

state.totalQuestions = quizQuestions.length;

// ==== UTILIDADES DIBUJO ====
function clearScreen() {
  ctx.fillStyle = COLORS.bg;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function drawFrame() {
  ctx.fillStyle = COLORS.darker;
  ctx.fillRect(4, 4, canvas.width - 8, canvas.height - 8);
  ctx.fillStyle = COLORS.bg;
  ctx.fillRect(8, 8, canvas.width - 16, canvas.height - 16);
}

function drawText(lines, x, y, lineHeight = 12) {
  ctx.fillStyle = COLORS.text;
  ctx.font = "10px monospace";
  for (let i = 0; i < lines.length; i++) {
    ctx.fillText(lines[i], x, y + i * lineHeight);
  }
}

// ==== SPRITES SIMPLES (player y boss) ====
function drawPlayer(x, y) {
  // Estudiante pixel art muy simple
  ctx.fillStyle = COLORS.darker;
  ctx.fillRect(x, y - 12, 10, 10); // cabeza
  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(x - 2, y - 2, 14, 12); // torso
  ctx.fillRect(x - 2, y + 10, 4, 8);  // pierna izq
  ctx.fillRect(x + 8, y + 10, 4, 8);  // pierna der
}

function drawBossMonster(label, x, y) {
  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(x, y - 10, 40, 22);
  ctx.fillStyle = COLORS.bg;
  ctx.fillRect(x + 5, y - 6, 6, 6);
  ctx.fillRect(x + 29, y - 6, 6, 6);
  ctx.fillStyle = COLORS.light;
  ctx.font = "8px monospace";
  ctx.fillText(label, x + 3, y + 16);
}

// ==== PANTALLAS ====
function renderTitle() {
  clearScreen();
  drawFrame();

  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(34, 34, 252, 40);

  ctx.fillStyle = COLORS.light;
  ctx.font = "15px monospace";
  ctx.fillText("VERB TO BE QUEST", 42, 60);

  ctx.font = "10px monospace";
  ctx.fillText("Game Boy Â· GramariON", 76, 78);

  const lines = [
    "",
    "Domina el VERB TO BE",
    "afirmativo, negativo e",
    "interrogativo jugando.",
    "",
    "Pensado para hispanohablantes",
    "nivel A1 que aman los juegos.",
    "",
    "PC: ENTER para empezar.",
    "MÃ³vil: toca OK."
  ];
  drawText(lines, 30, 110);
}

function renderStory() {
  clearScreen();
  drawFrame();
  drawText(storyPages[state.storyPage], 18, 26);
  ctx.font = "9px monospace";
  ctx.fillText("Historia", 12, 20);

  // Player sprite a un lado
  drawPlayer(260, 170);
}

function renderExplainBlock(block, label) {
  clearScreen();
  drawFrame();
  drawText(block[state.explainPage], 18, 26);
  ctx.font = "9px monospace";
  ctx.fillText(label, 12, 20);

  // pequeÃ±o icono libro
  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(260, 180, 28, 18);
  ctx.fillStyle = COLORS.light;
  ctx.fillRect(262, 182, 10, 14);
  ctx.fillRect(276, 182, 10, 14);
}

function renderQuiz() {
  clearScreen();
  drawFrame();

  const q = quizQuestions[state.quizIndex];

  // Titulo
  ctx.fillStyle = COLORS.dark;
  ctx.fillRect(12, 14, 296, 20);
  ctx.fillStyle = COLORS.light;
  ctx.font = "10px monospace";
  ctx.fillText("Boss Fight Â· Verb TO BE", 20, 28);

  // Player vs Boss
  drawPlayer(40, 150);
  drawBossMonster(q.boss, 215, 130);

  // Pregunta
  ctx.fillStyle = COLORS.text;
  ctx.font = "11px monospace";
  ctx.fillText(q.sentence, 30, 70);

  // Opciones
  ctx.font = "10px monospace";
  for (let i = 0; i < q.options.length; i++) {
    const isSelected = (i === state.selectionIndex);
    const y = 110 + i * 22;

    if (isSelected) {
      ctx.fillStyle = COLORS.dark;
      ctx.fillRect(50, y - 12, 220, 18);
      ctx.fillStyle = COLORS.light;
      ctx.fillText("> " + q.options[i], 58, y);
    } else {
      ctx.fillStyle = COLORS.text;
      ctx.fillText("  " + q.options[i], 58, y);
    }
  }

  // Progreso y tip
  ctx.font = "9px monospace";
  ctx.fillStyle = COLORS.dark;
  ctx.fillText(
    `Pregunta ${state.quizIndex + 1}/${state.totalQuestions}`,
    30,
    190
  );

  ctx.fillStyle = COLORS.text;
  ctx.fillText(q.tip, 30, 210);
  ctx.fillText("ENTER/OK = responder", 30, 226);
}

function renderSummary() {
  clearScreen();
  drawFrame();

  const percent = Math.round((state.score / state.totalQuestions) * 100);

  // Guardar mejor puntuaciÃ³n simple
  try {
    const prev = parseInt(localStorage.getItem("vtb_best") || "0", 10);
    if (!isNaN(prev) && percent > prev) {
      localStorage.setItem("vtb_best", String(percent));
    } else if (isNaN(prev)) {
      localStorage.setItem("vtb_best", String(percent));
    }
  } catch (e) {}

  let best = 0;
  try {
    best = parseInt(localStorage.getItem("vtb_best") || "0", 10);
  } catch (e) {
    best = percent;
  }

  const lines = [
    "FIN DEL LIBRO-JUEGO",
    "",
    `Puntaje: ${state.score} / ${state.totalQuestions}`,
    `Aciertos: ${percent}%`,
    `Mejor marca: ${best}%`,
    "",
    percent === 100
      ? "Â¡Perfecto! Eres el rey del TO BE."
      : percent >= 75
      ? "Muy bien, ya dominas lo basico."
      : "Repite el juego y lee las",
    percent >= 75 ? "" : "explicaciones otra vez.",
    "",
    "Consejo gamer:",
    "Piensa todo el dia con TO BE:",
    "I'm tired, I'm happy, I'm a gamer,",
    "You're my friend, We're students.",
    "",
    "ENTER/OK = Volver al titulo"
  ];
  drawText(lines, 26, 40);
}

// ==== FLASH DE MENSAJE ====
let flashText = "";
let flashTimer = 0;

function flashMessage(msg) {
  flashText = msg;
  flashTimer = 60; // frames
}

// ==== LOOP PRINCIPAL ====
function mainLoop() {
  switch (state.screen) {
    case SCREENS.TITLE:
      renderTitle();
      break;
    case SCREENS.STORY:
      renderStory();
      break;
    case SCREENS.EXPLAIN_AFFIRM:
      renderExplainBlock(explainAffirm, "Libro 1 Â· Afirmativo");
      break;
    case SCREENS.EXPLAIN_NEG:
      renderExplainBlock(explainNeg, "Libro 2 Â· Negativo");
      break;
    case SCREENS.EXPLAIN_INTER:
      renderExplainBlock(explainInter, "Libro 3 Â· Preguntas");
      break;
    case SCREENS.QUIZ:
      renderQuiz();
      break;
    case SCREENS.SUMMARY:
      renderSummary();
      break;
  }

  if (flashTimer > 0) {
    ctx.fillStyle = COLORS.darker;
    ctx.fillRect(0, canvas.height - 24, canvas.width, 24);
    ctx.fillStyle = COLORS.light;
    ctx.font = "10px monospace";
    ctx.fillText(flashText, 14, canvas.height - 8);
    flashTimer--;
  }

  requestAnimationFrame(mainLoop);
}
requestAnimationFrame(mainLoop);

// ==== CONTROL UNIFICADO (teclado/touch) ====
function handleControl(action) {
  if (!audioCtx && (action === "up" || action === "down" || action === "ok")) {
    initAudio();
  }

  // TITULO
  if (state.screen === SCREENS.TITLE) {
    if (action === "ok") {
      playBeep("ok");
      state.screen = SCREENS.STORY;
      state.storyPage = 0;
    } else if (action === "up" || action === "down") {
      playBeep("move");
    }
    return;
  }

  // STORY
  if (state.screen === SCREENS.STORY) {
    if (action === "ok") {
      playBeep("ok");
      if (state.storyPage < storyPages.length - 1) {
        state.storyPage++;
      } else {
        state.screen = SCREENS.EXPLAIN_AFFIRM;
        state.explainPage = 0;
      }
    }
    return;
  }

  // EXPLICACIONES
  if (
    state.screen === SCREENS.EXPLAIN_AFFIRM ||
    state.screen === SCREENS.EXPLAIN_NEG ||
    state.screen === SCREENS.EXPLAIN_INTER
  ) {
    if (action === "ok") {
      playBeep("ok");
      const maxPage =
        state.screen === SCREENS.EXPLAIN_AFFIRM
          ? explainAffirm.length
          : state.screen === SCREENS.EXPLAIN_NEG
          ? explainNeg.length
          : explainInter.length;

      if (state.explainPage < maxPage - 1) {
        state.explainPage++;
      } else {
        if (state.screen === SCREENS.EXPLAIN_AFFIRM) {
          state.screen = SCREENS.EXPLAIN_NEG;
          state.explainPage = 0;
        } else if (state.screen === SCREENS.EXPLAIN_NEG) {
          state.screen = SCREENS.EXPLAIN_INTER;
          state.explainPage = 0;
        } else {
          state.screen = SCREENS.QUIZ;
          state.selectionIndex = 0;
        }
      }
    }

    if (action === "skip") {
      playBeep("bad");
      state.screen = SCREENS.QUIZ;
      state.selectionIndex = 0;
    }
    return;
  }

  // QUIZ
  if (state.screen === SCREENS.QUIZ) {
    const q = quizQuestions[state.quizIndex];

    if (action === "up") {
      state.selectionIndex =
        (state.selectionIndex - 1 + q.options.length) % q.options.length;
      playBeep("move");
    } else if (action === "down") {
      state.selectionIndex =
        (state.selectionIndex + 1) % q.options.length;
      playBeep("move");
    } else if (action === "ok") {
      if (state.selectionIndex === q.correctIndex) {
        state.score++;
        playBeep("good");
        flashMessage("âœ” Correcto, derrotaste al boss.");
      } else {
        playBeep("bad");
        flashMessage(
          `âœ– Era: ${q.options[q.correctIndex]}`
        );
      }

      if (state.quizIndex < quizQuestions.length - 1) {
        state.quizIndex++;
        state.selectionIndex = 0;
      } else {
        state.screen = SCREENS.SUMMARY;
      }
    }
    return;
  }

  // SUMMARY
  if (state.screen === SCREENS.SUMMARY) {
    if (action === "ok") {
      playBeep("ok");
      state.screen = SCREENS.TITLE;
      state.selectionIndex = 0;
      state.storyPage = 0;
      state.explainPage = 0;
      state.quizIndex = 0;
      state.score = 0;
    }
  }
}

// Teclado
window.addEventListener("keydown", (e) => {
  const key = e.key;

  if (key === "ArrowUp") {
    handleControl("up");
  } else if (key === "ArrowDown") {
    handleControl("down");
  } else if (key === "Enter") {
    handleControl("ok");
  } else if (key === "Escape") {
    handleControl("skip");
  }
});

// Touch
document.querySelectorAll(".btn-control").forEach(btn => {
  const action = btn.getAttribute("data-action");
  if (!action) return;

  const fire = (ev) => {
    ev.preventDefault();
    handleControl(action);
  };

  btn.addEventListener("click", fire);
  btn.addEventListener("touchstart", fire, { passive: false });
});
</script>
</body>
</html>
